<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>ndnSIM QoS: ndnSIM/apps/ndn-synchronizer-socket.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
<link href="ns3_stylesheet.css" rel="stylesheet" type="text/css" />
<link href="favicon.ico" rel="shortcut icon" type="image/ico" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0" width="100%">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo">
	<a href="http://ndnSIM.net/">
	<img alt="ndnSIM QoS Logo" src="../_static/ndn-logo.png"/>
        </a>
	<a href="http://irl.cs.ucla.edu/">
	<img alt="IRL Logo" src="../_static/irl-logo.png"/>
        </a>
	<a href="http://nmsu.edu/">
	<img alt="NMSU Logo" src="../_static/nmsu-logo.png"/>
        </a>
  </td>
  <td id="projecttext">
   <div id="projectbrief">NS-3 based Named Data Networking (NDN) QoS simulator</div>
   <span id="projectnumber">ndnSIM 2.5: NDN, CCN, CCNx, content centric networks</span>
  </td>
  <td id="projectsection">
    <span style="margin-right:10px">API Documentation</span>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('ndn-synchronizer-socket_8cpp_source.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">ndn-synchronizer-socket.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="ndn-synchronizer-socket_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * Copyright ( C ) 2020 New Mexico State University</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> * George Torres, Anju Kunnumpurathu James</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> * This program is free software: you can redistribute it and/or modify</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> * it under the terms of the GNU General Public License as published by</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> * the Free Software Foundation, either version 3 of the License, or</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> * ( at your option ) any later version.</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> * This program is distributed in the hope that it will be useful,</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> * GNU General Public License for more details.</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> * You should have received a copy of the GNU General Public License</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> * along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160; </div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &lt;sys/types.h&gt;</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &lt;sys/socket.h&gt;</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &lt;netinet/in.h&gt;</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &lt;netdb.h&gt;</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &lt;unistd.h&gt;</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &lt;arpa/inet.h&gt;</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ndn-synchronizer-socket_8hpp.html">ndn-synchronizer-socket.hpp</a>&quot;</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &quot;ns3/ptr.h&quot;</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &quot;ns3/log.h&quot;</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &quot;ns3/simulator.h&quot;</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#include &quot;ns3/packet.h&quot;</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &quot;ns3/callback.h&quot;</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &quot;ns3/string.h&quot;</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#include &quot;ns3/boolean.h&quot;</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#include &quot;ns3/uinteger.h&quot;</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#include &quot;ns3/integer.h&quot;</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#include &quot;ns3/double.h&quot;</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160; </div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="keyword">using namespace </span>std;</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160; </div>
<div class="line"><a name="l00044"></a><span class="lineno"><a class="line" href="ndn-synchronizer-socket_8cpp.html#ac42367fe5c999ec6650de83e9d72fe8c">   44</a></span>&#160;<span class="preprocessor">#define SERVER_PORT htons( 5005 )</span></div>
<div class="line"><a name="l00045"></a><span class="lineno"><a class="line" href="ndn-synchronizer-socket_8cpp.html#ab5e65a957b83d792bcaf547766f49ac7">   45</a></span>&#160;<span class="preprocessor">#define CONNECTIONS 1</span></div>
<div class="line"><a name="l00046"></a><span class="lineno"><a class="line" href="ndn-synchronizer-socket_8cpp.html#ad72dbcf6d0153db1b8d8a58001feed83">   46</a></span>&#160;<span class="preprocessor">#define DEBUG 0</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160; </div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160; </div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespacens3.html">ns3</a> {</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="keyword">namespace </span>ndn {</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160; </div>
<div class="line"><a name="l00052"></a><span class="lineno"><a class="line" href="namespacens3_1_1ndn.html#add1971548e53af0a75674b33d1d085aa">   52</a></span>&#160;<span class="keyword">using</span> <a class="code" href="namespacens3_1_1ndn.html#add1971548e53af0a75674b33d1d085aa">json</a> = <a class="code" href="ndn-subscriber-sync_8cpp.html#ab701e3ac61a85b337ec5c1abaad6742d">nlohmann::json</a>;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160; </div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment">// On object construction create sockets and set references</span></div>
<div class="line"><a name="l00055"></a><span class="lineno"><a class="line" href="classns3_1_1ndn_1_1SyncSocket.html#a16c74e44b815138741ca3f171a5f2d35">   55</a></span>&#160;SyncSocket::SyncSocket() {</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160; </div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  parOpen.setRefs( &amp;nameMap, &amp;mapDER );</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  parRedis.setRefs( &amp;nameMap, &amp;mapDER );</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160; </div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  std::cout&lt;&lt;<span class="stringliteral">&quot;Start\n&quot;</span>;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160; </div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  <span class="comment">// Initialize socket</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  sockaddr_in serverAddr;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  server_socket=socket( AF_INET, SOCK_STREAM, 0 );</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  serverAddr.sin_family = AF_INET;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  serverAddr.sin_port = <a class="code" href="ndn-synchronizer-socket_8cpp.html#ac42367fe5c999ec6650de83e9d72fe8c">SERVER_PORT</a>;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  serverAddr.sin_addr.s_addr = INADDR_ANY;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160; </div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  <span class="comment">// Bind the socket</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  ret = bind( server_socket, ( <span class="keyword">struct</span> sockaddr* )&amp;serverAddr, <span class="keyword">sizeof</span>( <span class="keyword">struct</span> sockaddr ) );</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  <span class="keywordflow">if</span> ( ret &lt; 0 ) {</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;Bind error&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  }</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160; </div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  <span class="comment">// Listen for connections</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  ret = listen( server_socket, <a class="code" href="ndn-synchronizer-socket_8cpp.html#ab5e65a957b83d792bcaf547766f49ac7">CONNECTIONS</a> );</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  <span class="keywordflow">if</span> ( ret &lt; 0 ) {</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;Bind error&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  }</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160; </div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  sockaddr_in clientAddr;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  socklen_t sin_size = <span class="keyword">sizeof</span>( <span class="keyword">struct </span>sockaddr_in );</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160; </div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  <span class="comment">// Accept a connection</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  client_socket[0] = accept( server_socket, ( <span class="keyword">struct</span> sockaddr* )&amp;clientAddr, &amp;sin_size );</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  client_socket[1] = accept( server_socket, ( <span class="keyword">struct</span> sockaddr* )&amp;clientAddr, &amp;sin_size );</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  std::string output;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  output.resize( 8 );</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160; </div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  <span class="comment">// Client 1</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  ret = read( client_socket[0], &amp;output[0], 8-1 );</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160; </div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  <span class="keywordflow">if</span> ( ret &gt; 0 ) {</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;Server received from 1:  &quot;</span> &lt;&lt; output &lt;&lt; endl;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160; </div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <span class="comment">// Set client references based on order of connections</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    <span class="keywordflow">if</span>( output[0] == <span class="charliteral">&#39;O&#39;</span> ){</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;      OpenDSS = 0;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;      RedisPv = 1;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;      OpenDSS = 1;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;      RedisPv = 0;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    }</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  }</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160; </div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;  <span class="comment">// Client 2</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  ret = read( client_socket[1], &amp;output[0], <a class="code" href="ndn-synchronizer-socket_8hpp.html#a6b20d41d6252e9871430c242cb1a56e7">BUFFER_SIZE</a>-1 );</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;  <span class="keywordflow">if</span> ( ret &gt; 0 ) {</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;Server received from 2:  &quot;</span> &lt;&lt; output &lt;&lt; endl;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;  }</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;}</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160; </div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160; </div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment">// Add a string to list of packets that arrived at ReDis-PV and follower DERs</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment">// Input: Str; string with information on the arriving interest.</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l00117"></a><span class="lineno"><a class="line" href="classns3_1_1ndn_1_1SyncSocket.html#aa68069e4f15e8381360e784e83526e4d">  117</a></span>&#160;SyncSocket::addArrivedPackets( std::string str ) {</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160; </div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  std::vector&lt;std::string&gt; updateInfo = SplitString( str, 3 );</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  json::iterator it = rjf.begin();</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160; </div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  std::cout &lt;&lt; str &lt;&lt; std::endl;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160; </div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  <span class="comment">// Check if the sending packet is a lead DER. If not update running measurment json.</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  <span class="keywordflow">if</span> ( LeadDERs[updateInfo[1]] == <span class="keyword">false</span> ){</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    std::cout&lt;&lt;<span class="stringliteral">&quot;\nReDis-PV node ( ns3 ) received measurement data from non-PV devices\n&quot;</span>;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160; </div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <span class="keywordflow">while</span> ( it !=  rjf.end() ) {</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160; </div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;      <span class="keywordflow">if</span> ( it.key() != <span class="stringliteral">&quot;Time&quot;</span> &amp;&amp; it.value().find( updateInfo[1] ) != it.value().end() ) {</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160; </div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        it.value()[updateInfo[1]] = njf[it.key()][updateInfo[1]];</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        it = rjf.end();</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        it++;</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;      }</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    }</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160; </div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( updateInfo[3] != <span class="stringliteral">&quot;RedisPV&quot;</span> ) {</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    std::cout&lt;&lt;<span class="stringliteral">&quot;\nReDis-PV node ( ns3 ) received measurement data from PV Lead DERs\n&quot;</span>;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  }</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160; </div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  <span class="comment">// Push packet information into vector for later processing.</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  arrivedPackets.push_back( str );</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;}</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160; </div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160; </div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="comment">// Process packets with set point data, that arrive at a follwer DER or a lead DER and injectnew interest as needed.</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="comment">// Input: Send_json; the data we will be sending. Src; the source node from which interests will be sent.</span></div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="comment">// Device Name; the name of the reciving interest.</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="keywordtype">bool</span></div>
<div class="line"><a name="l00152"></a><span class="lineno"><a class="line" href="classns3_1_1ndn_1_1SyncSocket.html#a9e3b1588545113e0b643cbf3ae962aff">  152</a></span>&#160;SyncSocket::sendDirect( std::string send_json, <span class="keywordtype">int</span> src, std::string deviceName ) {</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160; </div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  <a class="code" href="namespacens3_1_1ndn.html#add1971548e53af0a75674b33d1d085aa">json</a> counter = json::parse( send_json );</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;  json::iterator it = counter.begin();</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  <span class="keywordtype">int</span> elements = 0;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  <span class="keywordtype">bool</span> lead = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160; </div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  <span class="comment">// Check if receiving packet is a follwer DER, if it is, update info for node.</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  <span class="comment">// If it is a lead DER count the number of followers it has.</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  <span class="keywordflow">while</span> ( it !=  counter.end() ) {</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160; </div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <span class="comment">// If we find measurment Data that means this is a follower DER</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <span class="keywordflow">if</span> ( it.key() == <span class="stringliteral">&quot;P&quot;</span> ) {</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;      lead = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;      senders[nameMap[deviceName]]-&gt;resetLead();</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    }</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160; </div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <span class="comment">// Update the lead DER information for this node</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <span class="keywordflow">if</span> ( it.key() == <span class="stringliteral">&quot;Lead_DER&quot;</span> ) {</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;      mapDER[deviceName] = it.value();</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;      mapDER[<span class="stringliteral">&quot;PV&quot;</span>+deviceName.substr( 4 )] =  it.value();</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;      std::cout &lt;&lt; <span class="stringliteral">&quot;Follower DER &quot;</span> &lt;&lt; deviceName &lt;&lt; <span class="stringliteral">&quot; set with Lead DER &quot;</span> &lt;&lt; it.value() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    }</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160; </div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    elements++;</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    it++;</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  }</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160; </div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;  <span class="comment">// If node is lead DER, update tables for node and send data to OpenDSS.</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  <span class="keywordflow">if</span> ( lead ) {</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    mapDER.erase( deviceName );</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    mapDER.erase( <span class="stringliteral">&quot;PV&quot;</span> + deviceName.substr( 4 ) );</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160; </div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    senders[nameMap[deviceName]]-&gt;setAsLead( deviceName );</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    leads--;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160; </div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;Lead DER &quot;</span> &lt;&lt; deviceName &lt;&lt; <span class="stringliteral">&quot; set with &quot;</span> &lt;&lt; elements-1 &lt;&lt; <span class="stringliteral">&quot; follower( s )\n&quot;</span>;</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160; </div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    sendData( send_json, OpenDSS );</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160; </div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;Sending clustering information for Lead DER &quot;</span> &lt;&lt; deviceName &lt;&lt; <span class="stringliteral">&quot; to OpenDSS&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="keywordflow">if</span> ( <a class="code" href="ndn-synchronizer-socket_8cpp.html#ad72dbcf6d0153db1b8d8a58001feed83">DEBUG</a> ) std::cout &lt;&lt; <span class="stringliteral">&quot;Leads left &quot;</span> &lt;&lt; leads &lt;&lt; std::endl;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;  }</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160; </div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;  <span class="comment">// If the lead DER has at least one follower wait for response from OpenDSS.</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;  <span class="keywordflow">if</span> ( elements &gt; 1 &amp;&amp; lead ) {</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    std::string data = receiveData( OpenDSS );</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160; </div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;Follower DER  information ( set points ) received from Lead DER &quot;</span> &lt;&lt; deviceName &lt;&lt; <span class="stringliteral">&quot; ( OpenDSS ), size: &quot;</span> &lt;&lt; data.size() &lt;&lt; std::endl;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="keywordflow">if</span> ( <a class="code" href="ndn-synchronizer-socket_8cpp.html#ad72dbcf6d0153db1b8d8a58001feed83">DEBUG</a> ) std::cout &lt;&lt; data &lt;&lt; std::endl;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160; </div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <a class="code" href="namespacens3_1_1ndn.html#add1971548e53af0a75674b33d1d085aa">json</a> follower = json::parse( data );</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    processLeadJson( follower, src );</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  }</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160; </div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  <span class="comment">// Inform caller if the node was a lead DER or not</span></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;  <span class="keywordflow">return</span> lead;</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;}</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160; </div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160; </div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="comment">// Send infromation gathered over span of the timestep to the co-simulators.</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l00214"></a><span class="lineno"><a class="line" href="classns3_1_1ndn_1_1SyncSocket.html#a4411220715199d994f944275f9da1837">  214</a></span>&#160;SyncSocket::sendSync() {</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160; </div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;  <span class="comment">// If this is time step zero, send initialization messages.</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  <span class="keywordflow">if</span> ( Simulator::Now().GetSeconds() == 0 ) {</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    ret = write( client_socket[OpenDSS], <span class="stringliteral">&quot;ndnSIM Simulation Started&quot;</span>,strlen( <span class="stringliteral">&quot;ndnSIM Simulation Started&quot;</span> ) );</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    ret = write( client_socket[RedisPv], <span class="stringliteral">&quot;Hello, Pv&quot;</span>,strlen( <span class="stringliteral">&quot;Hello, Pv&quot;</span> ) );</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160; </div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    <span class="keywordflow">if</span> ( ret &lt; 0 ) {</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;      cout &lt;&lt; <span class="stringliteral">&quot;Write failed&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    }</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160; </div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;  }</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160; </div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  <a class="code" href="namespacens3_1_1ndn.html#add1971548e53af0a75674b33d1d085aa">json</a> j;</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;  <a class="code" href="namespacens3_1_1ndn.html#add1971548e53af0a75674b33d1d085aa">json</a> openSend;</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160; </div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  <span class="comment">// Process all the saved strings with packet arrival information and send any relevent data.</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  <span class="keywordflow">while</span> ( !arrivedPackets.empty() ) {</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    std::vector&lt;std::string&gt; SendInfo = SplitString( arrivedPackets.back() , 0 );</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160; </div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    <span class="comment">// If data is from ReDis-PV, add to json string for OpenDSS.</span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <span class="keywordflow">if</span> ( SendInfo[3] == <span class="stringliteral">&quot;RedisPV&quot;</span> ) {</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;      openSend[SendInfo[1]] = SendInfo[4];</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( LeadDERs[SendInfo[1]] == <span class="keyword">true</span> ) {</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;      <span class="comment">// Update running json file with data that arrived at ReDis-PV from OpenDSS.</span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;      <span class="keywordflow">if</span> ( <a class="code" href="ndn-synchronizer-socket_8cpp.html#ad72dbcf6d0153db1b8d8a58001feed83">DEBUG</a> ) std::cout &lt;&lt; <span class="stringliteral">&quot;............Updating................\n&quot;</span>;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160; </div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;      <a class="code" href="namespacens3_1_1ndn.html#add1971548e53af0a75674b33d1d085aa">json</a> leadJson = json::parse( SendInfo[4] );</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;      json::iterator itLead = leadJson.begin();</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160; </div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;      <span class="keywordflow">while</span> ( itLead != leadJson.end() ) {</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160; </div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        <span class="keywordflow">if</span> ( rjf[<span class="stringliteral">&quot;Storage&quot;</span>].find( itLead.key() ) != rjf[<span class="stringliteral">&quot;Storage&quot;</span>].end() ) {</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;          rjf[<span class="stringliteral">&quot;Storage&quot;</span>][itLead.key()] = njf[<span class="stringliteral">&quot;Storage&quot;</span>][itLead.key()];</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160; </div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;          <span class="keywordflow">if</span> ( <a class="code" href="ndn-synchronizer-socket_8cpp.html#ad72dbcf6d0153db1b8d8a58001feed83">DEBUG</a> ) std::cout &lt;&lt; rjf[<span class="stringliteral">&quot;Storage&quot;</span>][itLead.key()] &lt;&lt; <span class="stringliteral">&quot;\n...............Storage................\n&quot;</span>;</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;        }</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160; </div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        <span class="keywordflow">if</span> ( rjf[<span class="stringliteral">&quot;PVSystem&quot;</span>].find( itLead.key() ) != rjf[<span class="stringliteral">&quot;PVSystem&quot;</span>].end() ) {</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;          rjf[<span class="stringliteral">&quot;PVSystem&quot;</span>][itLead.key()] = njf[<span class="stringliteral">&quot;PVSystem&quot;</span>][itLead.key()];</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160; </div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;          <span class="keywordflow">if</span> ( <a class="code" href="ndn-synchronizer-socket_8cpp.html#ad72dbcf6d0153db1b8d8a58001feed83">DEBUG</a> ) std::cout &lt;&lt; rjf[<span class="stringliteral">&quot;PVSystem&quot;</span>][itLead.key()] &lt;&lt; <span class="stringliteral">&quot;\n..............PVSystem.................\n&quot;</span>;</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        }</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160; </div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        itLead++;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;      }</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    }</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160; </div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    j[SendInfo[1]][<span class="stringliteral">&quot;ArrivalTime&quot;</span>] = SendInfo[2];</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    j[SendInfo[1]][<span class="stringliteral">&quot;PacketSize&quot;</span>] = SendInfo[0];</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160; </div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    arrivedPackets.pop_back();</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  }</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160; </div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  <span class="comment">// Send updated json files to OpenDss and ReDis-PV.</span></div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  std::string send_json = rjf.dump();</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160; </div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  sendData( send_json, RedisPv );</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;  std::cout &lt;&lt; <span class="stringliteral">&quot;Sending measurement.json to Redis-PV&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160; </div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;  send_json = openSend.dump();</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160; </div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;  sendData( send_json, OpenDSS );</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  std::cout &lt;&lt; <span class="stringliteral">&quot;Sending arrived Following DER ( at ns3 ) information to OpenDSS&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;}</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160; </div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;<span class="comment">// Implmentation of sending data over cpp socket.</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;<span class="comment">// Input; Data; the data to be sent. Socket; the socket we will be sending over.</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l00284"></a><span class="lineno"><a class="line" href="classns3_1_1ndn_1_1SyncSocket.html#ad9195bb6214f075cfec151d2cab29620">  284</a></span>&#160;SyncSocket::sendData( std::string data, <span class="keywordtype">int</span> socket ) {</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160; </div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  <a class="code" href="namespacens3_1_1ndn.html#add1971548e53af0a75674b33d1d085aa">json</a> packet;</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  <span class="keywordtype">int</span> n = ( data.size()/750 ) + 1;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;  std::string chunks[n];</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160; </div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;  <span class="comment">// Find nummber of chunks.</span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  <span class="keywordflow">for</span> ( i = 0; i&lt;n; i++ ) {</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    chunks[i] = data.substr( i*750, 750 );</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;  }</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160; </div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;  <span class="comment">// Set first key in packet dictionary - total size of one timestep data.</span></div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;  packet[<span class="stringliteral">&quot;size&quot;</span>] =  data.size();</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;  i = 0;</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160; </div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  <span class="comment">// Create packets out of chunks and send over socket.</span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;  <span class="keywordflow">while</span> ( i &lt; n ) {</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160; </div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    <span class="keywordflow">if</span> ( i &lt; n-1 ) {</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;      packet[<span class="stringliteral">&quot;finished&quot;</span>] = 0;</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;      packet[<span class="stringliteral">&quot;finished&quot;</span>] = 1;</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    }</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160; </div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    packet[<span class="stringliteral">&quot;payload&quot;</span>]  = chunks[i];</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    packet[<span class="stringliteral">&quot;payloadsize&quot;</span>] = chunks[i].size();</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160; </div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    <span class="comment">//std::cout &lt;&lt; &quot; Payload size : &quot; &lt;&lt; chunks[i].size() &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160; </div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    std::string zeroStr = <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    packet[<span class="stringliteral">&quot;0&quot;</span>] = zeroStr;</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    std::string pj = packet.dump();</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    <span class="keywordtype">int</span> zeros = 1023 - pj.size();</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160; </div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> z = 0; z &lt; zeros; z++ ) {</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;      zeroStr += <span class="stringliteral">&quot;0&quot;</span>;</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    }</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160; </div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    packet[<span class="stringliteral">&quot;0&quot;</span>] = zeroStr;</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    pj = packet.dump();</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160; </div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    <span class="comment">//std::cout &lt;&lt; &quot; PJ size : &quot; &lt;&lt; pj.size() &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160; </div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    i += 1;</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    ret = write( client_socket[socket],&amp;pj[0],pj.size() );</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160; </div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    <span class="keywordflow">if</span> ( ret &lt; 0 ) {</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;      cout &lt;&lt; <span class="stringliteral">&quot;Write failed&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    }</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160; </div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;  }</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;}</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160; </div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160; </div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;<span class="comment">// Receive data from co-simulators.</span></div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l00341"></a><span class="lineno"><a class="line" href="classns3_1_1ndn_1_1SyncSocket.html#a48178b9d586b50a3a3993a91af1ac269">  341</a></span>&#160;SyncSocket::receiveSync() {</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160; </div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;  std::string data = receiveData( OpenDSS );</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;  njf = json::parse( data );</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160; </div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;  std::cout &lt;&lt; <span class="stringliteral">&quot;\nMeasurement data received from OpenDSS, size: &quot;</span> &lt;&lt; data.size() &lt;&lt; <span class="stringliteral">&quot; bytes&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160; </div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;  data = receiveData( RedisPv );</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;  parOpen.processJson( njf, &amp;packetNames );</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160; </div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;  std::cout &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span> &lt;&lt;  data &lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160; </div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;  <span class="keywordflow">if</span>( data != <span class="stringliteral">&quot;&quot;</span> ) {</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    <a class="code" href="namespacens3_1_1ndn.html#add1971548e53af0a75674b33d1d085aa">json</a> cluster_info = json::parse( data );</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    parRedis.processJson( cluster_info,  &amp;packetNames, &amp;leads );</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    std::string send = to_string( leads );</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    ret = write( client_socket[OpenDSS],&amp;send[0],send.size() );</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    std::string send = to_string( 0 );</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    ret = write( client_socket[OpenDSS],&amp;send[0],send.size() );</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;  }</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160; </div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;  std::cout &lt;&lt; <span class="stringliteral">&quot;Clustering information ( set points ) received from ReDis-PV, size: &quot;</span> &lt;&lt; data.size() &lt;&lt; <span class="stringliteral">&quot; bytes&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160; </div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;}</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160; </div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="comment">// Implmentation for receiving data packet.</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="comment">// Input: Socket; the reciving socket ( for OpenDSS or ReDis-PV ).</span></div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;std::string</div>
<div class="line"><a name="l00370"></a><span class="lineno"><a class="line" href="classns3_1_1ndn_1_1SyncSocket.html#a6e45de38ce20734f82de94c68d77e30e">  370</a></span>&#160;SyncSocket::receiveData( <span class="keywordtype">int</span> socket ) {</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160; </div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;  <span class="keywordtype">bool</span> done = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;  std::string output, buff;</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;  output = <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;  buff.resize( <a class="code" href="ndn-synchronizer-socket_8hpp.html#a6b20d41d6252e9871430c242cb1a56e7">BUFFER_SIZE</a> );</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;  <span class="keywordtype">int</span> rec = 0;</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;  <span class="keywordtype">int</span> size = 0;</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160; </div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;  <span class="comment">// Read data from socket in pre-defined chunk sizes.</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;  <span class="keywordflow">while</span> ( !done ) {</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160; </div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    bzero( buffer, <a class="code" href="ndn-synchronizer-socket_8hpp.html#a6b20d41d6252e9871430c242cb1a56e7">BUFFER_SIZE</a> );</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160; </div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    <span class="comment">// Receive a message from a client.</span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    ret = read( client_socket[socket], &amp;buff[0], <a class="code" href="ndn-synchronizer-socket_8hpp.html#a6b20d41d6252e9871430c242cb1a56e7">BUFFER_SIZE</a>-1 );</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160; </div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    <span class="keywordflow">if</span> ( ret &gt; 0 &amp;&amp; ( ret != 1 || buff[0] != <span class="charliteral">&#39; &#39;</span> ) ) {</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;      <span class="comment">//cout &lt;&lt; &quot;Confirmation code  &quot; &lt;&lt; ret &lt;&lt; endl;</span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;      <span class="comment">//cout &lt;&lt; &quot;Server received:  &quot; &lt;&lt; output &lt;&lt; endl;</span></div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160; </div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;      <span class="keywordflow">while</span> ( ret &lt; 1023 ) {</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;        <span class="keywordtype">int</span> pret = read( client_socket[socket], &amp;buff[ret], <a class="code" href="ndn-synchronizer-socket_8hpp.html#a6b20d41d6252e9871430c242cb1a56e7">BUFFER_SIZE</a>-( ret +1 ) );</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;        ret += pret;</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;      }</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160; </div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;      <a class="code" href="namespacens3_1_1ndn.html#add1971548e53af0a75674b33d1d085aa">json</a> tempj = json::parse( buff );</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;      size = tempj[<span class="stringliteral">&quot;size&quot;</span>];</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160; </div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;      <span class="keywordflow">if</span>( tempj[<span class="stringliteral">&quot;finished&quot;</span>] == 1 ) {</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;        done = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;      }</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160; </div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;      output +=  tempj[<span class="stringliteral">&quot;payload&quot;</span>];</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;      <span class="keywordtype">int</span> temp = tempj[<span class="stringliteral">&quot;payloadsize&quot;</span>];</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;      rec  += temp;</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;      done = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    }</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160; </div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;  }</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160; </div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;  <span class="keywordflow">return</span> output;</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;}</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160; </div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160; </div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;<span class="comment">// Process Json file from Lead DER ( openDSS ) and create appropriate packets.</span></div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;<span class="comment">// Input: jf; the recived json file from OpenDSS. Src; the ns-3 node that will be the source of new interests.</span></div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l00419"></a><span class="lineno"><a class="line" href="classns3_1_1ndn_1_1SyncSocket.html#aecf1f8f5503778bae3e51bdc8c01d956">  419</a></span>&#160;SyncSocket::processLeadJson( <a class="code" href="namespacens3_1_1ndn.html#add1971548e53af0a75674b33d1d085aa">json</a> jf, <span class="keywordtype">int</span> src ) {</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160; </div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;  json::iterator it = jf.begin();</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160; </div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;  <span class="keywordflow">while</span> ( it !=  jf.end() ) {</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    std::string device;</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    std::string payload;</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    <span class="keywordtype">int</span> payloadSize;</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    std::string packet_insert;</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160; </div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    device = <span class="stringliteral">&quot;phy&quot;</span>+ std::to_string( nameMap[it.key()] ) + <span class="stringliteral">&quot;/&quot;</span>;</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    device += it.key();</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    device += <span class="stringliteral">&quot;/Lead&quot;</span>+std::to_string( src );</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160; </div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    payload = it.value().dump();</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    payloadSize = payload.size();</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    packet_insert = device + <span class="stringliteral">&quot; &quot;</span> + std::to_string( src ) +  <span class="stringliteral">&quot; &quot;</span> + payload;</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160; </div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    <span class="keywordflow">if</span> ( <a class="code" href="ndn-synchronizer-socket_8cpp.html#ad72dbcf6d0153db1b8d8a58001feed83">DEBUG</a> ) std::cout &lt;&lt; packet_insert &lt;&lt; std::endl;</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160; </div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    packetNames.push_back( packet_insert );</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    it++;</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;  }</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160; </div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;  injectInterests( <span class="keyword">false</span> );</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;}</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160; </div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160; </div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;<span class="comment">// Fill out hash map where we link deivce names to ns-3 nodes.</span></div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;<span class="comment">// Input: Json; has information on what names go with what device.</span></div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l00450"></a><span class="lineno"><a class="line" href="classns3_1_1ndn_1_1SyncSocket.html#aa44c3ea00d9852b1a09601d28f0135cd">  450</a></span>&#160;SyncSocket::fillNameMap( <a class="code" href="namespacens3_1_1ndn.html#add1971548e53af0a75674b33d1d085aa">json</a> jf ) {</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160; </div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;  json::iterator it = jf.begin();</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160; </div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;  <span class="keywordflow">while</span> ( it !=  jf.end() ) {</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    nameMap[it.key()]=it.value();</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    it++;</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;  }</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160; </div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;}</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160; </div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160; </div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;<span class="comment">// Create the first instance of our running measumernt Json.</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;<span class="comment">// Input: Json; An instance of th measurment data.</span></div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l00465"></a><span class="lineno"><a class="line" href="classns3_1_1ndn_1_1SyncSocket.html#ad82e520a24a09b31aa9b53919e17dd60">  465</a></span>&#160;SyncSocket::initializeJson( <a class="code" href="namespacens3_1_1ndn.html#add1971548e53af0a75674b33d1d085aa">json</a> jf ){</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160; </div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;  rjf =  jf;</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;}</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160; </div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;<span class="comment">// When packet arrives at Lead DER from follower DER, update Lead payload and send new packet to ReDis-PV.</span></div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;<span class="comment">// Input: Payload; the payload of the arriving interest. follower; the source node for interest Lead;</span></div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;<span class="comment">// the node the recived the interest.</span></div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l00474"></a><span class="lineno"><a class="line" href="classns3_1_1ndn_1_1SyncSocket.html#a2575b3b81cfefa2b9c4aee10df7d51f0">  474</a></span>&#160;SyncSocket::aggDER( std::string payload, <span class="keywordtype">int</span> src, std::string follower, std::string lead ) {</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160; </div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;  std::cout &lt;&lt; <span class="stringliteral">&quot;\nLead DER &quot;</span> &lt;&lt; lead &lt;&lt; <span class="stringliteral">&quot; received  measurments from Follower DER &quot;</span> &lt;&lt; follower &lt;&lt; <span class="stringliteral">&quot;, size: &quot;</span> &lt;&lt; payload.size() &lt;&lt; std::endl;</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;  senders[nameMap[lead]]-&gt;updateLeadMeasurements( payload, follower );</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;  LeadDERs[lead] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;  LeadDERs[follower] = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;  <span class="keywordtype">int</span> consumer = nameMap[lead];</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160; </div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;  std::string packet_insert = <span class="stringliteral">&quot;data/&quot;</span> + lead + <span class="stringliteral">&quot; &quot;</span> + std::to_string( consumer ) +  <span class="stringliteral">&quot; &quot;</span> + payload;</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;  packetNames.push_back( packet_insert );</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160; </div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;  injectInterests( <span class="keyword">true</span> );</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;}</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160; </div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160; </div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;}</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;}</div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<div class="ttc" id="anamespacens3_html"><div class="ttname"><a href="namespacens3.html">ns3</a></div><div class="ttdoc">Copyright (c) 2011-2015 Regents of the University of California.</div><div class="ttdef"><b>Definition:</b> <a href="ndn-aggregator_8cpp_source.html#l00043">ndn-aggregator.cpp:43</a></div></div>
<div class="ttc" id="andn-synchronizer-socket_8cpp_html_ab5e65a957b83d792bcaf547766f49ac7"><div class="ttname"><a href="ndn-synchronizer-socket_8cpp.html#ab5e65a957b83d792bcaf547766f49ac7">CONNECTIONS</a></div><div class="ttdeci">#define CONNECTIONS</div><div class="ttdef"><b>Definition:</b> <a href="ndn-synchronizer-socket_8cpp_source.html#l00045">ndn-synchronizer-socket.cpp:45</a></div></div>
<div class="ttc" id="andn-synchronizer-socket_8cpp_html_ad72dbcf6d0153db1b8d8a58001feed83"><div class="ttname"><a href="ndn-synchronizer-socket_8cpp.html#ad72dbcf6d0153db1b8d8a58001feed83">DEBUG</a></div><div class="ttdeci">#define DEBUG</div><div class="ttdef"><b>Definition:</b> <a href="ndn-synchronizer-socket_8cpp_source.html#l00046">ndn-synchronizer-socket.cpp:46</a></div></div>
<div class="ttc" id="andn-synchronizer-socket_8cpp_html_ac42367fe5c999ec6650de83e9d72fe8c"><div class="ttname"><a href="ndn-synchronizer-socket_8cpp.html#ac42367fe5c999ec6650de83e9d72fe8c">SERVER_PORT</a></div><div class="ttdeci">#define SERVER_PORT</div><div class="ttdef"><b>Definition:</b> <a href="ndn-synchronizer-socket_8cpp_source.html#l00044">ndn-synchronizer-socket.cpp:44</a></div></div>
<div class="ttc" id="andn-synchronizer-socket_8hpp_html"><div class="ttname"><a href="ndn-synchronizer-socket_8hpp.html">ndn-synchronizer-socket.hpp</a></div></div>
<div class="ttc" id="anamespacens3_1_1ndn_html_add1971548e53af0a75674b33d1d085aa"><div class="ttname"><a href="namespacens3_1_1ndn.html#add1971548e53af0a75674b33d1d085aa">ns3::ndn::json</a></div><div class="ttdeci">nlohmann::json json</div><div class="ttdef"><b>Definition:</b> <a href="ndn-synchronizer-socket_8cpp_source.html#l00052">ndn-synchronizer-socket.cpp:52</a></div></div>
<div class="ttc" id="andn-synchronizer-socket_8hpp_html_a6b20d41d6252e9871430c242cb1a56e7"><div class="ttname"><a href="ndn-synchronizer-socket_8hpp.html#a6b20d41d6252e9871430c242cb1a56e7">BUFFER_SIZE</a></div><div class="ttdeci">#define BUFFER_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="ndn-synchronizer-socket_8hpp_source.html#l00032">ndn-synchronizer-socket.hpp:32</a></div></div>
<div class="ttc" id="andn-subscriber-sync_8cpp_html_ab701e3ac61a85b337ec5c1abaad6742d"><div class="ttname"><a href="ndn-subscriber-sync_8cpp.html#ab701e3ac61a85b337ec5c1abaad6742d">json</a></div><div class="ttdeci">nlohmann::json json</div><div class="ttdoc">Copyright ( c ) 2011-2015 Regents of the University of California.</div><div class="ttdef"><b>Definition:</b> <a href="ndn-subscriber-sync_8cpp_source.html#l00042">ndn-subscriber-sync.cpp:42</a></div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_e9ed9e4c2a9be74cf2edea2a86d169c7.html">ndnSIM</a></li><li class="navelem"><a class="el" href="dir_0a0ea3b9bde683678fc3a0b2a2c2ca6e.html">apps</a></li><li class="navelem"><a class="el" href="ndn-synchronizer-socket_8cpp.html">ndn-synchronizer-socket.cpp</a></li>
    <li class="footer">Generated on Tue Dec 29 2020 23:01:33 for ndnSIM QoS by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.9.0 </li>
  </ul>
</div>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-21372502-8']);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</body>
</html>
